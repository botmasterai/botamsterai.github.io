<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  
  <link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon" />

  <title>Botmaster | Botmaster Basics</title>
  <link rel="stylesheet" href="../../css/tachyons.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link rel="stylesheet" href="../../css/notices.css" />
  <link rel="stylesheet" href="../../css/base16-tomorrow.light.css" />
  <link href="../../css/botmaster_style.css" rel="stylesheet">

</head>

<body>

<nav class="container center pa4 mb3">
  <div class="fl w-80 w-100-l">
    <a href="../../">
      <img class="v-mid" src="../../img/botmaster_light.svg" width="200" />
    </a>
  </div>
  <div class="fl w-20 tr dn-l f1 dusty-gray" onclick="showNavMenu()">
    &#9776;
  </div>
</nav>
<main class="container center">
  <div id="sidebar" class="fl w-100 w-20-l pr1-l dn di-l">
  <ul class="list mv2 ml4 ma2-l pa0">
    
      <h5 class="dusty-gray mt3 mb3 ttu">Documentation</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../documentation/botmaster/">
            Botmaster
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Getting Started</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/installation/">
            Installation
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/quickstart/">
            Quickstart
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/messenger-setup/">
            Messenger setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/slack-setup/">
            Slack setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/twitter-setup/">
            Twitter setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/telegram-setup/">
            Telegram setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/socketio-setup/">
            Socketio setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/webhooks/">
            Webhooks
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Working with Botmaster</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/botmaster-basics/">
            Botmaster Basics
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/middleware/">
            Middleware
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/writing-your-own-bot-class/">
            Writing your own Bot Class
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Middlewares</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../middlewares/official-middleware/">
            Official Middleware
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../middlewares/fulfill/">
            Fulfill
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Tutorials</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../tutorials/watson-conversation/">
            Watson Conversation
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../tutorials/using-fulfill/">
            Using Fulfill
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Articles</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../articles/frameworks-comparison/">
            Frameworks comparison
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Updates</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../updates/changelog/">
            Changelog
          </a>
        </li>
      
    
  </ul>
</div>

  <div class="fl w-80-l w-100 pl2-l">
    <div class="bg-white br2 mt3">
      <div class="tc bg-black-pearl pv4 br--top2">
        <h1 class="fw5 white">Botmaster Basics</h1>
      </div>
      <div class="pa4">

<h3 id="bot-object">Bot object</h3>

<p>Hopefully, by now you&rsquo;ve gathered your credentials for at least one platform and got some basic bot running. We remember from the <a href="../../getting-started/quickstart">quickstart</a> and the various Setup guides in <a href="../../getting-started">getting-started</a> that we can start a botmaster project like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">Botmaster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botmaster&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">botmaster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">();</span>
<span class="p">.</span>
<span class="p">.</span> <span class="c1">// full settings objects omitted for brevity</span>
<span class="p">.</span>
<span class="kr">const</span> <span class="nx">messengerBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">MessengerBot</span><span class="p">(</span><span class="nx">messengerSettings</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">slackBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">SlackBot</span><span class="p">(</span><span class="nx">slackSettings</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">socketioBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">SocketioBot</span><span class="p">(</span><span class="nx">socketioSettings</span><span class="p">));</span>
<span class="kr">const</span> <span class="nx">twitterBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">TwitterBot</span><span class="p">(</span><span class="nx">twitterSettings</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">telegramBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">TelegramBot</span><span class="p">(</span><span class="nx">telegramSettings</span><span class="p">);</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">messengerBot</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">slackBot</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">twitterBot</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">socketioBot</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">telegramBot</span><span class="p">);</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
</code></pre></div>

<p>As it turns out, bot objects are really the ones running the show in the Botmaster framework. Your <code>botmaster</code> object is simply a central point of control for you to manage all of your bots. Botmaster assumes that most of your bots will have a central bit of code that you don&rsquo;t want to have to replicate for every platform/bot instance. Which should make sense.</p>

<p>Although the point of botmaster is for developers to do something like this after declaring the botmaster instance:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// do stuff with your bot and update here</span>
<span class="p">});</span>
</code></pre></div>

<p>One could (but shouldn&rsquo;t) just as well do:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">messengerBot</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// do stuff with your messenger bot here</span>
<span class="p">});</span>

<span class="c1">// this applies to all the bot objects that would have been declared separately.</span>
</code></pre></div>

<p>I say one shouldn&rsquo;t do that here because the only reason why this callback would work in this situation is because we&rsquo;ve already called <code>botmaster.addBot(messengerBot)</code>. If we hadn&rsquo;t done that, we would have to mount the <code>messengerBot</code> object onto an express app ourselves. See <a href="../../working-with-botmaster/writing-your-own-bot-class">writing your own bot class</a> to read more on this.</p>

<p>The <code>update</code> object in the event callback is the same as the botmaster <code>update</code> one you would get in the botmaster update callback. Of course the <code>messenger.on(...)</code> piece of code would only apply to your <code>messengerBot</code> instance and not the others.</p>

<p>As seen, bot instances can be accessed directly within an <code>update</code> event. Because you might want to act differently on bots of a certain type or log information differently based on type, every bot comes with a <code>bot.type</code> parameter that is one of: <code>messenger</code>, <code>slack</code>, <code>twitter</code>, <code>socketio</code>, <code>telegram</code> or whatever third-party bot class you might have installed or created.</p>

<p>It is important to note here, that you can have multiple bot objects for a certain type. I&rsquo;m sure you can find reasons for why you would want to do this. This is important to mention, as you might have, say, 2 bots of type <code>messenger</code> dealt with via Botmaster. You might want to do platform specific code by doing the following:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">bot</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;messenger&#39;</span> <span class="p">{</span>
    <span class="c1">// do messenger specific stuff</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div>

<p>Then you might want to do bot object specific code. You would do this as such:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">bot</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;messenger&#39;</span> <span class="p">{</span>
    <span class="c1">// do messenger specific stuff</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">bot</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;YOUR_BOT_ID&#39;</span><span class="p">)</span> <span class="p">{</span><span class="c1">// this will be the user id of bot for messenger</span>
      <span class="c1">// do bot object specific stuff</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div>

<p>Or if you declared your bots and botmaster as in the beginning of this section, you might have done the following:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">Botmaster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botmaster&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">botmaster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">();</span>
<span class="c1">// These are some of the bot classes that come with Botmaster</span>
<span class="kr">const</span> <span class="nx">Messengerbot</span> <span class="o">=</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">MessengerBot</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">SlackBot</span> <span class="o">=</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">SlackBot</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">TwitterBot</span> <span class="o">=</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">TwitterBot</span><span class="p">;</span>
<span class="p">.</span>
<span class="p">.</span> <span class="c1">// full settings objects omitted for brevity</span>
<span class="p">.</span>
<span class="kr">const</span> <span class="nx">messengerBot1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessengerBot</span><span class="p">(</span><span class="nx">messengerSettings1</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">messengerBot2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessengerBot</span><span class="p">(</span><span class="nx">messengerSettings2</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">slackBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SlackBot</span><span class="p">(</span><span class="nx">slackSettings</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">twitterBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TwitterBot</span><span class="p">(</span><span class="nx">twitterSettings</span><span class="p">);</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">messengerBot</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">slackBot</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">twitterBot</span><span class="p">);</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">bot</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;messenger&#39;</span> <span class="p">{</span>
    <span class="c1">// do messenger bot specific stuff</span>


    <span class="k">if</span> <span class="p">(</span><span class="nx">bot</span> <span class="o">===</span> <span class="nx">messengerBot1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// without using ids</span>
      <span class="c1">// do messengerBot1 specific stuff</span>
    <span class="p">}</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div>

<div class="notices warning" ><p>Botmaster does not assure you that the <code>id</code> parameter of the <code>bot</code> object will exist upon instantiation. the <code>id</code> is only assured to be there once an update has been received by the bot. This is because some ids aren&rsquo;t known until botmaster knows &lsquo;who&rsquo; the message was sent to (i.e. what id your bot should have).</p>
</div>


<p>I&rsquo;ll note quickly that each bot object created comes from one of the various bot classes as seen above. They act in the same way on the surface (because of heavy standardization), but have a few idiosynchrasies here and there.</p>

<p>Also useful to note is that you can access all the bots added to botmaster by doing <code>botmaster.bots</code>. you can also use <code>botmastet.getBot</code> or <code>botmaster.getBots</code> to get a specific bot (using type or id);</p>

<p>It is important to take note of the <code>addBot</code> syntax as you can create your own Bot class that extends the <code>Botmaster.botTypes.BaseBot</code> class. For instance, you might want to create your own class that supports your pre-existing messaging standards. Have a look at the <a href="working-with-botmaster/writing-a-botmaster-supported-bot-class-readme.md">working with a botmaster supported bot class </a> documentation to learn how to do this.</p>

<h3 id="settings">Settings</h3>

<p>Botmaster can be started with a so-called <code>botmasterSettings</code> object. It has the following parameters:
The <code>botmasterSettings</code> object has the following parameters:</p>

<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>port</td>
<td>(<strong>optional</strong>) The port to use for your webhooks (see <a href="#webhooks">webhooks</a> to understand more about webhooks). This will only be used if the <code>app</code> parameter is not provided. Otherwise, it will be ignored</td>
</tr>

<tr>
<td>app</td>
<td>(<strong>optional</strong>) An <code>express.js</code> app object to mount the <code>webhookEnpoints</code> onto. If you choose to do this, it is assumed that you will be starting your own express server and this won&rsquo;t be done by Botmaster. Unless you also specify a <code>server</code> parameter, <code>botmaster.server</code> will be <code>undefined</code></td>
</tr>
</tbody>
</table>

<div class="notices warning" ><p><code>botsSettings</code> and <code>server</code> parameters have been deprecated in version 2.2.3. Please use <code>addBot</code> instead of botsSettings and set the socketio server in your socketSettings object.</p>
</div>


<p>Using botsSettings would look something like this if you want to set the port:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">Botmaster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botmaster&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">botmasterSettings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// by default botmaster will start an express server that listens on port 3000</span>
  <span class="c1">// you can pass in a port argument here to change this default setting:</span>
  <span class="nx">port</span><span class="o">:</span> <span class="mi">3001</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">botmaster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">(</span><span class="nx">botmasterSettings</span><span class="p">);</span>

<span class="p">.</span>
<span class="p">.</span> <span class="c1">// rest of code adding bots to botmaster etc</span>
<span class="p">.</span>
</code></pre></div>

<div class="notices info" ><p>Please note, unless you are passing in an <code>app</code> object to the settings, it is assumed that you don&rsquo;t want to deal with anything relating to an http server. That is, botmaster will create an express server under the hood and expose both: <code>botmaster.app</code> and <code>botmaster.server</code>.</p>
</div>


<h4 id="setting-botmastersettings-to-use-botmaster-with-your-own-express-app">Setting <code>botmasterSettings</code> to use Botmaster with your own express() app</h4>

<p>Here&rsquo;s an example on how to do so if you are setting your credentials in your environment variables:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Botmaster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botmaster&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">botmasterSettings</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">app</span><span class="o">:</span> <span class="nx">app</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">botmaster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">(</span><span class="nx">botmasterSettings</span><span class="p">);</span>

<span class="c1">// settings and adding those to botmaster</span>
<span class="kr">const</span> <span class="nx">telegramSettings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">credentials</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">authToken</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TELEGRAM_TOKEN</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">webhookEndpoint</span><span class="o">:</span> <span class="s1">&#39;/webhook1234/&#39;</span><span class="p">,</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">messengerSettings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">credentials</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">verifyToken</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MESSENGER_VERIFY_TOKEN</span><span class="p">,</span>
    <span class="nx">pageToken</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MESSENGER_PAGE_TOKEN</span><span class="p">,</span>
    <span class="nx">fbAppSecret</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FACEBOOK_APP_SECRET</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">webhookEndpoint</span><span class="o">:</span> <span class="s1">&#39;/webhook1234/&#39;</span><span class="p">,</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">messengerBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">MessengerBot</span><span class="p">(</span><span class="nx">messengerSettings</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">telegramBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">TelegramBot</span><span class="p">(</span><span class="nx">telegramSettings</span><span class="p">);</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">messengerBot</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">telegramBot</span><span class="p">);</span>
<span class="c1">////////</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">({</span>
    <span class="nx">recipient</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">message</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;Well right back at you!&#39;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// start server on the specified port and binding host</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// print a message when the server starts listening</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Running App on port: </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="setting-botmastersettings-to-use-botmaster-with-your-own-express-app-and-own-server-object">Setting <code>botmasterSettings</code> to use Botmaster with your own express() app and own server object</h4>

<p>This example is what you should base your code on if you are using socket.io and your own http server object rather than the default botmaster one.</p>

<p>Here&rsquo;s an example on how to do so if you are setting your credentials in your environment variables:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">Botmaster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botmaster&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">myServer</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">botmasterSettings</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">app</span><span class="o">:</span> <span class="nx">app</span> <span class="p">};</span>
<span class="kr">const</span> <span class="nx">botmaster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">(</span><span class="nx">botmasterSettings</span><span class="p">);</span>

<span class="c1">// settings and adding those to botmaster</span>
<span class="kr">const</span> <span class="nx">telegramSettings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">credentials</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">authToken</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TELEGRAM_TOKEN</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">webhookEndpoint</span><span class="o">:</span> <span class="s1">&#39;/webhook1234/&#39;</span><span class="p">,</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">socketioSettings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;SOME_ID&#39;</span><span class="p">,</span>
  <span class="nx">server</span><span class="o">:</span> <span class="nx">myServer</span><span class="p">,</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">telegramBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">TelegramBot</span><span class="p">(</span><span class="nx">telegramSettings</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">socketioBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">SocketioBot</span><span class="p">(</span><span class="nx">socketioSettings</span><span class="p">);</span>


<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">messengerBot</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">socketioBot</span><span class="p">);</span>
<span class="c1">////////</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">({</span>
    <span class="nx">recipient</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">message</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;Well right back at you!&#39;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// start server on the specified port and binding host</span>
<span class="nx">myServer</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// print a message when the server starts listening</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Running App on port: </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>The difference between this example and the previous one is that in the previous, we are using the express helper <code>app.listen</code> which essentially wraps around the <code>http</code> <code>server.listen</code> and returns a server instance. Whereas here we are doing it all ourselves and use <code>myServer.listen</code>.</p>

<h3 id="events">Events</h3>

<p>Botmaster is built on top of the EventEmitter node.js class. Which means it can emit events and most importantly for us here, it can listen onto them. By doing any of the following:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;server running&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bot</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">update</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">bot</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>These are the only four listeners that you can listen onto in botmaster. Let&rsquo;s go though them briefly:</p>

<h4 id="server-running">server running</h4>

<p>This event will be emitted only if you are not managing your own server (i.e. you started botmaster without setting the <code>app</code> parameter). It is just here to notify you that the server has been started. You don&rsquo;t necessarily need to use it. But you might want to do things at this point.</p>

<h4 id="update">update</h4>

<p>This is really where all the magic happens. Whenever a message (update in Botmaster semantic) is sent into your application. Botmaster will parse it and format it into its [FB Messenger] standard. Along with it, you will get a <code>bot</code> object which is the underlying object into which the message was sent. Note that the updates are standardized as well as the methods to use from the bot object (i.e. sending a message). Read further down to see how those two objects work.</p>

<h4 id="error">error</h4>

<p>This event is thrown whenever an error internal to Botmaster occurs. I.e. if for some reason a misconfigured message was sent in. Or if some other kind of error occurred directly within Botmaster. It is good to listen onto this event and keep track of potential errors. Also, if you code an error within <code>botmaster.on</code>, and don&rsquo;t catch it, it will be caught by Botmaster and emitted in to <code>error</code>. So like this you have full control of what is going on and can log everything straight from there.</p>

<h2 id="message-update-format">Message/Update format</h2>

<p>Standardization is at the heart of Botmaster. The framework was really created for that purpose. This means that messages coming from any platform have to have the same format.</p>

<p>In order to do that, the <strong>Facebook Messenger message format</strong> was chosen and adopted. This means that when your botmaster object receives an &lsquo;update&rsquo; event from anywhere, you can be sure that it will be of the same format as a similar message that would come from Facebook Messenger.</p>

<h3 id="incoming-update">Incoming update</h3>

<p>Typically, it would look something like this for a message with an image attachment. Independent of what platform the message comes from:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="p">{</span>
  <span class="nx">raw</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">platform_specific_raw_update</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">sender</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">id_of_sender</span><span class="o">&gt;</span>
  <span class="p">},</span>
  <span class="nx">recipient</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">id_of_the_recipent</span><span class="o">&gt;</span> <span class="c1">// will typically be the bot&#39;s id</span>
  <span class="p">},</span>
  <span class="nx">timestamp</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">unix_miliseconds_timestamp</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="nx">message</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">mid</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">message_id</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">seq</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">message_sequence_id</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">attachments</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span>
        <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;https://scontent.xx.fbcdn.net/v/.....&#39;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<p>This allows developers to handle these messages in one place only rather than doing it in multiple places. For more info on the various incoming messages formats, read the messenger bot doc on webhooks at: <a href="https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-received">https://developers.facebook.com/docs/messenger-platform/webhook-reference/message-received</a>.</p>

<p>Currently, you will only get updates for <code>Messages</code> (and not delivery, echo notification etc) for all platforms. On Messenger, it is assumed that you don&rsquo;t want to get updates for delivery, read and echo. This can&rsquo;t be turned on at the moment, but will be in later versions as it might be a requirement.</p>

<h4 id="note-on-attachment-types-and-conversions">Note on attachment types and conversions</h4>

<p>Attachment type conversion on incoming updates works as such for <strong>Twitter</strong>:</p>

<table>
<thead>
<tr>
<th>Twitter Type</th>
<th>Botmaster conversion</th>
</tr>
</thead>

<tbody>
<tr>
<td>photo</td>
<td>image</td>
</tr>

<tr>
<td>video</td>
<td>video</td>
</tr>

<tr>
<td>gif</td>
<td>video</td>
</tr>
</tbody>
</table>

<p>!!!Yes <code>gif</code> becomes a <code>video</code>. because Twitter doesn&rsquo;t actually use gifs the way you would expect it to. It simply loops over a short <code>.mp4</code> video.</p>

<p>Also, here&rsquo;s an important caveat for Twitter bot developers who are receiving attachments. Image links that come in from the Twitter API will be private and not public, which makes using them quite tricky. You might need to make authenticated requests to do so. The twitterBot objects you will receive in the update will have a <code>bot.twit</code> object. Documentation for how to use this is available <a href="https://github.com/ttezel/twit">here</a>.</p>

<p>Receiving and sending attachments [the Botmaster way] is not yet supported on <strong>Slack</strong> as of version 2.2.3. However, Slack supports url unfurling (meaning if you send images and other types of media urls in your message, this will be shown in the messages and users won&rsquo;t just see a url). Also, because of how Botmaster is built (i.e. keep all information from the original message) you can find all the necessary information in the <code>update.raw</code> object of the update.</p>

<p>Attachment type conversion works as such for <strong>Telegram</strong>:</p>

<table>
<thead>
<tr>
<th>Telegram Type</th>
<th>Botmaster conversion</th>
</tr>
</thead>

<tbody>
<tr>
<td>audio</td>
<td>audio</td>
</tr>

<tr>
<td>voice</td>
<td>audio</td>
</tr>

<tr>
<td>photo</td>
<td>image</td>
</tr>

<tr>
<td>video</td>
<td>video</td>
</tr>

<tr>
<td>location</td>
<td>location</td>
</tr>

<tr>
<td>venue</td>
<td>location</td>
</tr>
</tbody>
</table>

<p><code>contact</code> attachment types aren&rsquo;t supported in Messenger. So in order to deal with them in Botmaster, you will have to look into your <code>update.raw</code> object which is the standard Telegram update. You will find your contact object in <code>update.raw.contact</code>.</p>

<p>Also, concerning <code>location</code> and <code>venue</code> attachments. The url received in Botmaster for Telegram is a google maps one with the coordinates as query parameters. It looks something like this: <code>https://maps.google.com/?q=&lt;lat&gt;,&lt;long&gt;</code></p>

<p>A few of you will want to use attachments with your <code>socket.io</code> bots. Because the Botmaster message standard is the Facebook Messenger one, everything is URL based. Which means it is left to the developer to store both incoming and outgoing attachments. A tutorial on how to deal with this will be up soon in the <a href="../../tutorials">Tutorials</a> section.</p>

<h3 id="outgoing-messages">Outgoing messages</h3>

<p>Again, outgoing messages are expected to be formatted like messages the Messenger platform would expect. They will typically look something like this for a text message:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">recipient</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">message</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;Some arbitrary text of yours&#39;</span>
  <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>

<p>and you would use this as such in code:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">recipient</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">message</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;Some arbitrary text of yours&#39;</span>
    <span class="p">},</span>
  <span class="p">};</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>typically, you would want to perform some action upon confirmation that the message was sent or catch a potential error. doing so is done like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span>

  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
  <span class="p">})</span>

  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="p">})</span>
<span class="p">});</span>
</code></pre></div>

<p>The <code>body</code> part of the response has the following structure:</p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>raw</td>
<td>raw response body (response from the platform).</td>
</tr>

<tr>
<td>recipient_id</td>
<td>id of user who sent the message</td>
</tr>

<tr>
<td>message_id</td>
<td>id of message that was just sent</td>
</tr>

<tr>
<td>sent_message</td>
<td>full object that was just sent after going through all the outgoing middlewares</td>
</tr>
</tbody>
</table>

<p>You can also opt to use callbacks rather than promises and this would work as such:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>

<p>Typically, this method (and all its accompanying helper ones that follow) will hit all your setup outgoing middleware (read more about middleware <a href="../../working-with-botmaster/middleware">here</a> if you don&rsquo;t know about them yet). If you want to avoid that and ignore your setup middleware in certain situations, do something like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="p">.</span>
  <span class="p">.</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="p">{</span> <span class="nx">ignoreMiddleware</span><span class="o">:</span> <span class="kc">true</span> <span class="p">})</span>
<span class="p">});</span>
</code></pre></div>

<p>And its signature is as follows:</p>

<p><code>bot.sendMessage</code></p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>message</td>
<td>a full valid messenger message object.</td>
</tr>

<tr>
<td>sendOptions</td>
<td>(<strong>optional</strong>) an object containing options regarding the sending of the message. One of those options is: <code>ignoreMiddleware</code>.</td>
</tr>

<tr>
<td>cb</td>
<td>(<strong>optional</strong>) callback function if you don&rsquo;t want to use botmaster with promises.</td>
</tr>
</tbody>
</table>

<p>As you can see, the <code>sendMessage</code> method used is used directly from the bot object and not using the botmaster one.</p>

<p>Because you might not always want to code in a complex json object just to send in a simple text message or photo attachment, Botmaster comes with a few helper methods that can be used to send messages with less code:</p>

<p><code>bot.sendMessageTo</code></p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>message</td>
<td>an object without the recipient part. In the previous example, it would be <code>message.message</code>.</td>
</tr>

<tr>
<td>recipientId</td>
<td>a string representing the id of the user to whom you want to send the message.</td>
</tr>

<tr>
<td>sendOptions</td>
<td>(<strong>optional</strong>) an object containing options regarding the sending of the message. One of those options is: <code>ignoreMiddleware</code>.</td>
</tr>

<tr>
<td>cb</td>
<td>(<strong>optional</strong>) callback function if you don&rsquo;t want to use botmaster with promises.</td>
</tr>
</tbody>
</table>

<p><code>bot.sendTextMessageTo</code></p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>text</td>
<td>just a string with the text you want to send to your user</td>
</tr>

<tr>
<td>recipientId</td>
<td>a string representing the id of the user to whom you want to send the message.</td>
</tr>

<tr>
<td>sendOptions</td>
<td>(<strong>optional</strong>) an object containing options regarding the sending of the message. One of those options is: <code>ignoreMiddleware</code>.</td>
</tr>

<tr>
<td>cb</td>
<td>(<strong>optional</strong>) callback function if you don&rsquo;t want to use botmaster with promises.</td>
</tr>
</tbody>
</table>

<p>Typically used like so to send a text message to the user who just spoke to the bot:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendTextMessageTo</span><span class="p">(</span><span class="s1">&#39;something super important&#39;</span><span class="p">,</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p><code>bot.reply</code></p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>update</td>
<td>an update object with a valid <code>update.sender.id</code>.</td>
</tr>

<tr>
<td>text</td>
<td>just a string with the text you want to send to your user</td>
</tr>

<tr>
<td>sendOptions</td>
<td>(<strong>optional</strong>) an object containing options regarding the sending of the message. One of those options is: <code>ignoreMiddleware</code>.</td>
</tr>

<tr>
<td>cb</td>
<td>(<strong>optional</strong>) callback function if you don&rsquo;t want to use botmaster with promises.</td>
</tr>
</tbody>
</table>

<p>This is is typically used like so:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="s1">&#39;something super important!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="attachments">Attachments</h4>

<p><code>bot.sendAttachmentTo</code></p>

<p>We&rsquo;ll note here really quickly that Messenger only takes in urls for file attachment (image, video, audio, file). Most other platforms don&rsquo;t support sending attachments in this way. So we fall back to sending the url in text which really results in a very similar output. Same goes for Twitter that doesn&rsquo;t support attachments at all.</p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>attachment</td>
<td>a valid Messenger style attachment. See <a href="https://developers.facebook.com/docs/messenger-platform/send-api-reference">here</a> for more on that.</td>
</tr>

<tr>
<td>recipientId</td>
<td>a string representing the id of the user to whom you want to send the message.</td>
</tr>

<tr>
<td>sendOptions</td>
<td>(<strong>optional</strong>) an object containing options regarding the sending of the message. One of those options is: <code>ignoreMiddleware</code>.</td>
</tr>

<tr>
<td>cb</td>
<td>(<strong>optional</strong>) callback function if you don&rsquo;t want to use botmaster with promises.</td>
</tr>
</tbody>
</table>

<p>This is the general attachment sending method that will always work for Messenger but not necessarily for other platforms as Facebook Messenger supports all sorts of attachments that other platforms don&rsquo;t necessarily support. So beware when using it. To assure your attachment will be sent to all platforms, use <code>bot.sendAttachmentFromURLTo</code>.</p>

<p>This is typically used as such for sending an image url.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">attachment</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;image&#39;</span>
    <span class="nx">payload</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;some image url you&#39;ve got&quot;</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">};</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendAttachment</span><span class="p">(</span><span class="nx">attachment</span><span class="p">,</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p><code>bot.sendAttachmentFromURLTo</code></p>

<p>Just easier to use this to send standard url attachments. And URL attachments if used properly should work on all out-of-the-box platforms:</p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>type</td>
<td>string representing the type of attachment (audio, video, image or file)</td>
</tr>

<tr>
<td>url</td>
<td>the url to your file</td>
</tr>

<tr>
<td>recipientId</td>
<td>a string representing the id of the user to whom you want to send the message.</td>
</tr>

<tr>
<td>sendOptions</td>
<td>(<strong>optional</strong>) an object containing options regarding the sending of the message. One of those options is: <code>ignoreMiddleware</code>.</td>
</tr>

<tr>
<td>cb</td>
<td>(<strong>optional</strong>) callback function if you don&rsquo;t want to use botmaster with promises.</td>
</tr>
</tbody>
</table>

<p>This is typically used as such for sending an image url.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendAttachmentFromURLTo</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s2">&quot;some image url you&#39;ve got&quot;</span><span class="p">,</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h4 id="status">Status</h4>

<p><code>bot.sendIsTypingMessageTo</code></p>

<p>To indicate that something is happening on your bots end, you can show your users that the bot is &lsquo;working&rsquo; or &lsquo;typing&rsquo; something. to do so, simply invoke sendIsTypingMessageTo.</p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>recipientId</td>
<td>a string representing the id of the user to whom you want to send the message.</td>
</tr>

<tr>
<td>sendOptions</td>
<td>(<strong>optional</strong>) an object containing options regarding the sending of the message. One of those options is: <code>ignoreMiddleware</code>.</td>
</tr>

<tr>
<td>cb</td>
<td>(<strong>optional</strong>) callback function if you don&rsquo;t want to use botmaster with promises.</td>
</tr>
</tbody>
</table>

<p>It is used as such:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendIsTypingMessageTo</span><span class="p">(</span><span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>It will only send a request to the platforms that support it. If unsupported, nothing will happen.</p>

<h4 id="buttons">Buttons</h4>

<p>Buttons will almost surely be part of your bot. Botmaster provides a method that will send what is assumed to be a decent way to display buttons throughout all platforms.</p>

<p><code>bot.sendDefaultButtonMessageTo</code></p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>buttonTitles</td>
<td>array of button titles (no longer than 10 in size).</td>
</tr>

<tr>
<td>recipientId</td>
<td>a string representing the id of the user to whom you want to send the message.</td>
</tr>

<tr>
<td>textOrAttachment</td>
<td>(<strong>optional</strong>) a string or an attachment object similar to the ones required in <code>bot.sendAttachmentTo</code>. This is meant to provide context to the buttons. I.e. why are there buttons here. A piece of text or an attachment could detail that. If not provided,  text will be added that reads: &lsquo;Please select one of:&lsquo;. This is only optional if none of sendOptions and cb is specified</td>
</tr>

<tr>
<td>sendOptions</td>
<td>(<strong>optional</strong>) an object containing options regarding the sending of the message. One of those options is: <code>ignoreMiddleware</code>.</td>
</tr>

<tr>
<td>cb</td>
<td>(<strong>optional</strong>) callback function if you don&rsquo;t want to use botmaster with promises.</td>
</tr>
</tbody>
</table>

<p>The function defaults to sending <code>quick_replies</code> in Messenger, setting <code>Keyboard buttons</code> in Telegram, buttons in Slack and simply prints button titles one on each line in Twitter as it doesn&rsquo;t support buttons. The user is expecting to type in their choice in Twitter. In the socketio implementation, the front-end/app developer is expected to write the code that would display the buttons on their front-end.</p>

<p>It is used as such:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">buttonArray</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;button1&#39;</span><span class="p">,</span> <span class="s1">&#39;button2&#39;</span><span class="p">];</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendDefaultButtonMessageTo</span><span class="p">(</span><span class="nx">buttonArray</span><span class="p">,</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="s1">&#39;Please select &quot;button1&quot; or &quot;button2&quot;&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<div class="notices warning" ><p>If you will be using either of <code>sendOptions</code> or <code>cb</code>, you will need to specify <code>textOrAttachment</code>.</p>
</div>


<h4 id="cascade">Cascade</h4>

<p>In order to send a cascade of messages (i.e. multiple messages one after another), you might want to have a look at both of these methods:</p>

<p><code>bot.sendCascadeTo</code></p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>messageArray</td>
<td>Array of messages in a format as such: [{text: &lsquo;something&rsquo;}, {message: someMessengerValidMessage}] read below to see valid keys.</td>
</tr>

<tr>
<td>recipientId</td>
<td>a string representing the id of the user to whom you want to send the message.</td>
</tr>
</tbody>
</table>

<p>As you might have guessed, Botmaster assures you that the objects in the messageArray will be sent in order. Furthermore, the objects of the messageArray must be of a certain form where valid params are the following:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="p">{</span>
  <span class="nx">raw</span><span class="o">:</span> <span class="nx">SOME_VALID_RAW_MESSAGE</span><span class="p">,</span> <span class="c1">// the same object as one you would send with sendRaw()</span>
  <span class="nx">message</span><span class="o">:</span> <span class="nx">SOME_VALID_MESSENGER_MESSAGE</span><span class="p">,</span> <span class="c1">// the same object as one you would send with sendMessage() (i.e. the recipientId won&#39;t be taken into account!)</span>
  <span class="nx">buttons</span><span class="o">:</span> <span class="nx">SOME_ARRAY_OF_BUTTON_TITLES</span><span class="p">,</span> <span class="c1">// same as what you would do with: sendDefaultButtonMessageTo. If you will be sending attachments/text alongside it, add them in the following fields. If both are present, the attachment will be used.</span>
  <span class="nx">attachment</span><span class="o">:</span> <span class="nx">SOME_ATTACHMENT</span><span class="p">,</span> <span class="c1">// same object format as in: sendAttachmentTo()</span>
  <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;some text&#39;</span><span class="p">,</span> <span class="c1">// same as when using sendTextMessageTo()</span>
  <span class="nx">isTyping</span><span class="o">:</span> <span class="nx">SOME_TRUTHY_VALUE</span><span class="p">,</span> <span class="c1">// will call sendIsTypingMessageTo() on the recipientId used in sendCascade.</span>
<span class="p">}</span>
</code></pre></div>

<div class="notices info" ><p>It is important to note that all these parameters will be hit in the shown order if present. I.e. if <code>raw</code> is present, <code>message</code> will not be hit nor will <code>buttons</code> be hit etc.</p>
</div>


<p>You could typically use this as such:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">rawMessage</span> <span class="o">=</span> <span class="nx">SOME_RAW_PLATFORM_MESSAGE</span><span class="p">;</span>

  <span class="kr">const</span> <span class="nx">fullMessage</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">recipient</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="nx">someUserId</span><span class="p">,</span> <span class="c1">// note that I am not using update.sender.id on purpose here, so as to show that this overrides the recipientId from the sendCascade Method</span>
    <span class="p">},</span>
    <span class="nx">message</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;Some arbitrary text of yours&#39;</span>
    <span class="p">},</span>
  <span class="p">};</span>

  <span class="kr">const</span> <span class="nx">buttonsArray</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;button1&#39;</span><span class="p">,</span> <span class="s1">&#39;button2&#39;</span><span class="p">];</span>
  <span class="kr">const</span> <span class="nx">textForButtons</span> <span class="o">=</span> <span class="s1">&#39;Please select one of the two buttons&#39;</span><span class="p">;</span>

  <span class="kr">const</span> <span class="nx">someText</span> <span class="o">=</span> <span class="s1">&#39;some text message after all this&#39;</span><span class="p">;</span>

  <span class="nx">bot</span><span class="p">.</span><span class="nx">sendCascadeTo</span><span class="p">([</span>
    <span class="p">{</span> <span class="nx">raw</span><span class="o">:</span> <span class="nx">rawMessage</span><span class="p">},</span>
    <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="nx">fullMessage</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">isTyping</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">buttons</span><span class="o">:</span> <span class="nx">buttonsArray</span><span class="p">,</span>
      <span class="nx">text</span><span class="o">:</span> <span class="nx">textForButtons</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="nx">isTyping</span><span class="o">:</span> <span class="kc">true</span> <span class="p">},</span>
    <span class="p">{</span> <span class="nx">text</span><span class="o">:</span> <span class="nx">someText</span> <span class="p">},</span>
  <span class="p">],</span> <span class="nx">update</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
<span class="p">});</span>
</code></pre></div>

<p>Where our <code>recipientId</code> is set to <code>update.sender.id</code>.</p>

<p>In this example, the bot will send a rawMessage and then a botmaster supported message to the platform (both these messages will not take into consideration the recipientId (update.sender.id) set in sendCascade). Then it will send a button message and then a standard text message. Both these last messages will be sent to the specified recipientId (again, update.sender.id). Note that before each message sent to the recipient, I also send an &lsquo;isTyping&rsquo; message to the recipient. I purposefully do not do so for the first two messages as it is assumed here that those messages are not being sent to the recipient, but to some other user.</p>

<p><code>bot.sendTextCascadeTo</code></p>

<table>
<thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>textMessageArray</td>
<td>Array of strings that you want to send to the user in sequences.</td>
</tr>

<tr>
<td>recipientId</td>
<td>a string representing the id of the user to whom you want to send the message.</td>
</tr>
</tbody>
</table>

<p>This method is really just a helper for calling <code>bot.sendCascadeTo</code>. It just allows developers to use the method with an array of texts rather than an array of objects.</p>

<p>Something like this will do:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">bot</span><span class="p">.</span><span class="nx">sendTextCascadeTo</span><span class="p">([</span><span class="s1">&#39;message1&#39;</span><span class="p">,</span> <span class="s1">&#39;message2&#39;</span><span class="p">],</span> <span class="nx">user</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</code></pre></div>

<p><code>sendOptions</code> is an optional argument that can take in the following parameters (for now)</p>

<table>
<thead>
<tr>
<th>key/option</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>ignoreMiddleware</td>
<td>outgoing middleware will not be hit if this parameter is set to true (or any truthy value)</td>
</tr>
</tbody>
</table>

<p>If you want to learn more about middleware and why you might want to use any of these options, read more about middleware <a href="../../working-with-botmaster/middleware">here</a></p>
</div>
    </div>
  </main>
  <script>
    function showNavMenu() {
      var sidebar = document.getElementById('sidebar')

      if (sidebar.className.indexOf('dn') !== -1) {
        sidebar.className = 'fl w-100 w-20-l pr2-l di-l'
      } else {
        sidebar.className = 'fl w-100 w-20-l pr2-l di-l dn'
      }
    }
  </script>
</body>

</html>

