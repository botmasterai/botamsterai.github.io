<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  
  <link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon" />

  <title>Botmaster | Slack Setup</title>
  <link rel="stylesheet" href="../../css/tachyons.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link rel="stylesheet" href="../../css/notices.css" />
  <link rel="stylesheet" href="../../css/base16-tomorrow.light.css" />
  <link href="../../css/botmaster_style.css" rel="stylesheet">

</head>

<body>

<nav class="container center pa4 mb3">
  <div class="fl w-80 w-100-l">
    <a href="../../">
      <img class="v-mid" src="../../img/botmaster_light.svg" width="200" />
    </a>
  </div>
  <div class="fl w-20 tr dn-l f1 dusty-gray" onclick="showNavMenu()">
    &#9776;
  </div>
</nav>
<main class="container center">
  <div id="sidebar" class="fl w-100 w-20-l pr1-l dn di-l">
  <ul class="list mv2 ml4 ma2-l pa0">
    
      <h5 class="dusty-gray mt3 mb3 ttu">Documentation</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../documentation/botmaster/">
            Botmaster
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Getting Started</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/installation/">
            Installation
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/quickstart/">
            Quickstart
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/messenger-setup/">
            Messenger setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/slack-setup/">
            Slack setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/twitter-setup/">
            Twitter setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/telegram-setup/">
            Telegram setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/socketio-setup/">
            Socketio setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/webhooks/">
            Webhooks
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Working with Botmaster</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/botmaster-basics/">
            Botmaster Basics
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/middleware/">
            Middleware
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/writing-your-own-bot-class/">
            Writing your own Bot Class
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Middlewares</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../middlewares/official-middleware/">
            Official Middleware
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../middlewares/fulfill/">
            Fulfill
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Tutorials</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../tutorials/watson-conversation/">
            Watson Conversation
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../tutorials/using-fulfill/">
            Using Fulfill
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Articles</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../articles/frameworks-comparison/">
            Frameworks comparison
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Updates</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../updates/changelog/">
            Changelog
          </a>
        </li>
      
    
  </ul>
</div>

  <div class="fl w-80-l w-100 pl2-l">
    <div class="bg-white br2 mt3">
      <div class="tc bg-black-pearl pv4 br--top2">
        <h1 class="fw5 white">Slack Setup</h1>
      </div>
      <div class="pa4">

<h2 id="the-botmaster-slack-bot">The Botmaster Slack bot</h2>

<p>Because Slack works slightly differently from the other platforms covered in the core Botmaster package, I will briefly explain here what your botmaster Slack bot will be exactly.</p>

<p>As you surely know, Slack is a product that enables team members to communicate easily with one another. because of that, one team member can&rsquo;t just &ldquo;add&rdquo; a bot for herself in the same way one would in Facebook Messenger or Telegram or other.</p>

<p>Teams can either build a bot that will only live within their own slack team. Or they can package a bot in a Slack app that &ldquo;packages&rdquo; the bot.
Admin team members can add support for a bot (by installing an App that packages said bot) and then team members can start communicating with it as they would with another team member. At this point, they would be communicating with what is known as, in Slack semantics, a <strong>bot user</strong>.</p>

<p>All the information required by Slack concerning this is setup in the <code>slackSettings</code> object within Botmaster. This will allow us to create a Slack Bot object that communicates to end users via this <strong>bot user</strong> that needs to be set up on Slack&rsquo;s end. Because this whole setup and gathering the proper credentials is not as trivial as one might want and quite unclear on their website, here&rsquo;s a mini-tutorial to get you started with Botmaster * Slack.</p>

<h2 id="botmaster-slack-bot-mini-tutorial">Botmaster Slack bot mini-tutorial</h2>

<p>Following these steps, you will have a fully functional Slack bot using Botmaster that can then be edited as wanted. This mini-tutorial uses localtunnel to expose one of your ports to the world. see why you might want to use this and how to install and setup localtunnel <a href="../../getting-started/webhooks#localtunnel">here</a> for your local botmaster project. You can use ngrok or any other service you know or find suitable and achieve the same result.</p>

<h4 id="create-an-app">Create an app</h4>

<p>Navigate to: <a href="https://api.slack.com/apps">https://api.slack.com/apps</a> and make sure you are signed in. If you aren&rsquo;t you will be redirected to your team&rsquo;s slack once logged in and will need to go back to the mentioned link.</p>

<p>Click the <strong>create new App</strong> button and enter any App Name you want. This won&rsquo;t be the name of the <strong>bot user</strong>. However, the name should ideally be related to your bot user so as not to confuse your users. For instance, if your bot user will be called <em>my_super_bot</em>, calling the app something like <em>My Super Bot App</em> would make sense.</p>

<h4 id="get-your-first-credentials">Get your first credentials</h4>

<p>On this page you were redirected to, you will find an <em>App credentials</em> section. Both your Client ID (<code>clientId</code> in Botmaster) and your Client Secret (<code>clientSecret</code> in Botmaster) are here. Take note of them.</p>

<h4 id="setup-your-app-s-oauth-webhook">Setup Your App&rsquo;s OAuth Webhook</h4>

<p>You don&rsquo;t need to know anything about OAuth to complete this step. Just know that this URL will be called when people are installing/authorizing your app.</p>

<p>In the left panel, click on the <strong>OAuth &amp; Permissions</strong> tab and enter your webhook in the <strong>Redirect URL(s)</strong> field as shown here:
    <img src="../../images/slack_setup_1.png?width=90%" alt="Slack Setup 1" />
This URL has to be of the form: <strong>https://&lt;your_base_url&gt;/slack/&lt;webhookEndpoint&gt;</strong>. For example, <strong>if</strong> I am using localtunnel to test the bot locally, and started localtunnel by running the following:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>  lt -p <span class="m">3000</span> -s botmastersubdomain
</code></pre></div>

<p>I would set my Redirect URL(s) to: <code>https://botmastersubdomain.localtunnel.me/slack/webhookd24sr34se</code> (based on the <code>webhookEnpoint</code> set in my <code>slackSettings</code> in the &ldquo;Start your Botmaster App Locally&rdquo; section). Click on <strong>Save Changes</strong>.</p>

<h4 id="add-a-bot-user">Add a Bot User</h4>

<p>Go to <strong>Bot Users</strong> and click on the <strong>Add a Bot User</strong> button. Select a name for your bot (e.g. my_super_bot) and click the <strong>Add Bot User</strong> button.</p>

<h4 id="get-the-rest-of-your-credentials">Get the rest of your credentials</h4>

<p>Navigate to the <strong>Event Subscriptions</strong> tab and click on the toggle button in the to right corner to <strong>on</strong>. Then in the <strong>Request URL</strong> field that pops up, enter the same URL as in the OAuth &amp; Permissions tab. <strong>You will get an error</strong>. This is normal and is due to two reasons. Firstly, we don&rsquo;t actually have an app started and listening at the mentioned URL and secondly because even if we did, we don&rsquo;t have our App&rsquo;s verification Token. Let&rsquo;s fix this!</p>

<p>Navigate back to <strong>Basic Information</strong> and note that you now have a <strong>Verification Token</strong> in the App Credentials box. Take note of it.</p>

<h4 id="start-your-botmaster-app-locally">Start your Botmaster App Locally</h4>

<p>Start your botmaster app in any project folder you might want (see <a href="../../getting-started/installation">here</a> if you haven&rsquo;t installed botmaster yet). To start the botmaster project, you&rsquo;ll want to create an <code>app.js</code> file with the following contents:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">Botmaster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botmaster&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">botmaster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">slackSettings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">credentials</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">clientId</span><span class="o">:</span> <span class="s1">&#39;YOUR app client ID&#39;</span><span class="p">,</span>
    <span class="nx">clientSecret</span><span class="o">:</span> <span class="s1">&#39;YOUR app client secret&#39;</span><span class="p">,</span>
    <span class="nx">verificationToken</span><span class="o">:</span> <span class="s1">&#39;YOUR app verification Token&#39;</span>
  <span class="p">},</span>
  <span class="nx">webhookEndpoint</span><span class="o">:</span> <span class="s1">&#39;/webhookd24sr34se&#39;</span><span class="p">,</span>
  <span class="nx">storeTeamInfoInFile</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">slackBot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Botmaster</span><span class="p">.</span><span class="nx">botTypes</span><span class="p">.</span><span class="nx">SlackBot</span><span class="p">(</span><span class="nx">slackSettings</span><span class="p">);</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">addBot</span><span class="p">(</span><span class="nx">slackBot</span><span class="p">);</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="s1">&#39;Hello world!&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>and place it at the root of your project folder. Replace the credentials with the ones you have gathered. Run <code>node app.js</code> to start the app. Let&rsquo;s now expose our bot to the world.</p>

<p>For the webhook to work locally, you&rsquo;ll now need to make sure you&rsquo;ve started localtunnel. If you are doing all of that from a server that already has a Domain Name, you won&rsquo;t need to do this. But I am assuming most people are doing this from their local computer. so in the command line, run something like this:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>lt -p <span class="m">3000</span> -s &lt;wanted_base_url_for_your_bot&gt;
</code></pre></div>

<h4 id="setup-your-app-s-events-and-events-webhook">Setup Your App&rsquo;s Events and Events Webhook</h4>

<p>Go back to the <strong>Event subscription</strong> page and enter your webhook url again. This should now work and look something like this: <img src="../../images/slack_setup_2.png?width=90%" alt="Slack Setup 2" /> Scroll down and click on <strong>Add Bot User Events</strong>. At the minimum, add the following events:
    * message.ipm
    * message.channels
    * message.im
    * message.groups
Click <strong>Save Changes</strong></p>

<h4 id="install-your-slack-app">Install your Slack App</h4>

<p>We&rsquo;re almost done here. We need a way to install our app to test it out. This is done via what is called a <strong>Slack button</strong>. because botmaster manages all the nitty-gritty parts of this process, all you need to do is create a <code>views</code> folder in your project folder and create an <code>index.html</code> file in this views folder with the following contents</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://slack.com/oauth/authorize?scope=bot&amp;client_id=YOUR_APP_CLIENT_ID&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">img</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Add to Slack&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;40&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;139&quot;</span>
  <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://platform.slack-edge.com/img/add_to_slack.png&quot;</span>
  <span class="na">srcset</span><span class="o">=</span><span class="s">&quot;https://platform.slack-edge.com/img/add_to_slack.png 1x,</span>
<span class="s">          https://platform.slack-edge.com/img/add_to_slack@2x.png 2x&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</code></pre></div>

<p>Note that you&rsquo;ll need to replace <strong>YOUR_APP_CLIENT_ID</strong> in the href with your own. You definitely don&rsquo;t want to put in your client secret here!</p>

<h4 id="try-out-your-bot">Try out your bot!</h4>

<p>Assuming your botmaster app and localtunnel are still running, open your <code>index.html</code> file (not in a text editor, but actually in a browser) by double clicking on it. Authorize your newly created app to add it to your team. You should now be redirected to your teams slack and be able to chat to your bot.</p>

<h4 id="make-your-bot-available-to-the-world">Make your Bot Available to the World</h4>

<p>You might actually want to allow others to install your app by using the Slack Button. However, to do so you will need to host it somewhere. We&rsquo;ll take advantage of the fact that botmaster uses express.js under the hood and edit our app.js file to look like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">Botmaster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botmaster&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span> <span class="c1">// added</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span><span class="p">));</span> <span class="c1">//added</span>
<span class="c1">// or if you don&#39;t want it at the root of your app, add this:</span>
<span class="nx">botmaster</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/slack&#39;</span><span class="p">,</span> <span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/views&#39;</span><span class="p">));</span> <span class="c1">// added</span>

<span class="nx">botmaster</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">bot</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">bot</span><span class="p">.</span><span class="nx">reply</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="s1">&#39;Right back at you&#39;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>Make sure to add either one of the <code>botmaster.app.use...</code> lines.
If you pick the first one, navigate to your URL (<code>https://botmastersubdomain.localtunnel.me/</code> for this example) and you will see the button.
If your pick the second one, navigate to your sub URL (<code>https://botmastersubdomain.localtunnel.me/slack</code> for this example) to see the Slack button.</p>

<h2 id="webhooks">Webhooks</h2>

<p>Now as with any other platform using Webhooks, you&rsquo;ll need to update these to your production Domain Name once you deploy your code to production. And in a more general sense, if you are still unsure how webhooks work within the botmaster framework, go <a href="../../getting-started/webhooks">here</a></p>
</div>
    </div>
  </main>
  <script>
    function showNavMenu() {
      var sidebar = document.getElementById('sidebar')

      if (sidebar.className.indexOf('dn') !== -1) {
        sidebar.className = 'fl w-100 w-20-l pr2-l di-l'
      } else {
        sidebar.className = 'fl w-100 w-20-l pr2-l di-l dn'
      }
    }
  </script>
</body>

</html>

