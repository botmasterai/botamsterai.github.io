<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  
  <link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon" />

  <title>Botmaster | Webhooks</title>
  <link rel="stylesheet" href="../../css/tachyons.css" />
  <link rel="stylesheet" href="../../css/main.css" />
  <link rel="stylesheet" href="../../css/notices.css" />
  <link rel="stylesheet" href="../../css/base16-tomorrow.light.css" />
  <link href="../../css/botmaster_style.css" rel="stylesheet">

</head>

<body>

<nav class="container center pa4 mb3">
  <div class="fl w-80 w-100-l">
    <a href="../../">
      <img class="v-mid" src="../../img/botmaster_light.svg" width="200" />
    </a>
  </div>
  <div class="fl w-20 tr dn-l f1 dusty-gray" onclick="showNavMenu()">
    &#9776;
  </div>
</nav>
<main class="container center">
  <div id="sidebar" class="fl w-100 w-20-l pr1-l dn di-l">
  <ul class="list mv2 ml4 ma2-l pa0">
    
      <h5 class="dusty-gray mt3 mb3 ttu">Documentation</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../documentation/botmaster/">
            Botmaster
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Getting Started</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/installation/">
            Installation
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/quickstart/">
            Quickstart
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/messenger-setup/">
            Messenger setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/slack-setup/">
            Slack setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/twitter-setup/">
            Twitter setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/telegram-setup/">
            Telegram setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/socketio-setup/">
            Socketio setup
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../getting-started/webhooks/">
            Webhooks
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Working with Botmaster</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/botmaster-basics/">
            Botmaster Basics
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/middleware/">
            Middleware
          </a>
        </li>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../working-with-botmaster/writing-your-own-bot-class/">
            Writing your own Bot Class
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Middlewares</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../middlewares/fulfill/">
            Fulfill
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Tutorials</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../tutorials/watson-conversation/">
            Watson Conversation
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Articles</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../articles/frameworks-comparison/">
            Frameworks comparison
          </a>
        </li>
      
    
      <h5 class="dusty-gray mt3 mb3 ttu">Updates</h5>
      
        <li class="mb2">
          <a class="no-underline cerulean-blue" href="../../updates/changelog/">
            Changelog
          </a>
        </li>
      
    
  </ul>
</div>

  <div class="fl w-80-l w-100 pl2-l">
    <div class="bg-white br2 mt3">
      <div class="tc bg-black-pearl pv4 br--top2">
        <h1 class="fw5 white">Webhooks</h1>
      </div>
      <div class="pa4">

<p>Most platforms rely on webhooks to work. As such, you are expected to setup webhooks on the various platforms that use them in order to use Botmaster with these platforms. In the &lsquo;Getting started&rsquo; part of this documentation, we briefly touched onto that for Telegram and Messenger and more deeply for Slack.</p>

<p>If you are still unsure what webhooks are and how they work, within the context of chatbots, they are simply a URL provided by you pointing to where you expect messages and other updates to come in.</p>

<p>Any platform that requires webhooks won&rsquo;t work without a webhookEndpoint parameter in their settings. E.g. for Telegram:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kr">const</span> <span class="nx">telegramSettings</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">credentials</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">authToken</span><span class="o">:</span> <span class="s1">&#39;YOUR authToken&#39;</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nx">webhookEndpoint</span><span class="o">:</span> <span class="s1">&#39;/webhook1234/&#39;</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>

<p>This will mount your telegram webhook on: <code>https://Your_Domain_Name:3000/messenger/webhook1234</code>. And yes, you will need ssl in order to work with most platforms.</p>

<p>As an added layer of security, it is highly recommended that you include a sort of a code in your webhookEndpoint. I.e., rather that having this: <code>webhookEndpoint: '/webhook/'</code>, do something more like this: <code>webhookEndpoint: '/webhook92ywrnc9qm4qoiuthecvasdf42FG/'</code>. This will assure that you know where the request is coming from. It is more important on Telegram than on other platforms as Telegram doesn&rsquo;t give us any way to verify the source of the message.</p>

<p>Now we realize you will want to develop and test your code without always deploying to a server with a valid url that supports ssl.</p>

<h3 id="on-a-local-machine">On a local machine:</h3>

<p>We recommend using the great localtunnel tool that proxies one of your ports to their url (with a potential wanted subdomain) using ssh.</p>

<p>Simply install localtunnel on local machine:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>npm install -g localtunnel
</code></pre></div>

<p>Then run the localtunnel with a predetermined subdomain. e.g:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>lt -p <span class="m">3000</span> -s botmastersubdomain //for example
</code></pre></div>

<p><code>-p</code> is the port and <code>-s</code> is the subdomain we want.
<code>-l</code> is for the localhost we want to point to. This is useful is you are using botmaster inside of a container. For instance if using docker-machine, simply <code>-l</code> to your docker-machines ip and <code>-p</code> to the port that your container exposes.</p>

<p>In the example above, url will be: <code>http://botmastersubdomain.localtunnel.me</code>. Localtunnel is great and supports both ssl and non ssl request, which means we will actually wan to use: <code>https://botmastersubdomain.localtunnel.me</code></p>

<p>So if you specified your messenger&rsquo;s bot webhook endpoint to, say, /webhook1234/, you will have to set up the webhook for your demo app at:</p>

<pre><code>https://botmastersubdomain.localtunnel.me/messenger/webhook1234/
</code></pre>

<p>For Telegram, it would look something like this:</p>

<pre><code>https://botmastersubdomain.localtunnel.me/telegram/webhook1234/
</code></pre>

<p>If you keep on getting an error that looks like this:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>your url is: https://customname.localtunnel.me
/usr/local/lib/node_modules/localtunnel/bin/client:58
        throw err<span class="p">;</span>
        ^

Error: connection refused: localtunnel.me:44404 <span class="o">(</span>check your firewall settings<span class="o">)</span>
    at Socket.&lt;anonymous&gt; <span class="o">(</span>/usr/local/lib/node_modules/localtunnel/lib/TunnelCluster.js:47:32<span class="o">)</span>
    at emitOne <span class="o">(</span>events.js:96:13<span class="o">)</span>
    at Socket.emit <span class="o">(</span>events.js:188:7<span class="o">)</span>
    at emitErrorNT <span class="o">(</span>net.js:1272:8<span class="o">)</span>
    at _combinedTickCallback <span class="o">(</span>internal/process/next_tick.js:74:11<span class="o">)</span>
    at process._tickCallback <span class="o">(</span>internal/process/next_tick.js:98:9<span class="o">)</span>
</code></pre></div>

<p>This is due to a bug in localtunnel. You can either go try out ngrok (which you will have to pay for), or try this workaround in the terminal:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">(</span><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
  lt -p <span class="m">3000</span> -s botmastersubdomain
<span class="k">done</span><span class="o">)</span>
</code></pre></div>

<p>or:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="o">(</span> <span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> lt -p <span class="m">3000</span> -s botmastersubdomain<span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="o">)</span>
</code></pre></div>

<p>If you prefer a one liner.</p>

<p>This will just restart the process whenever it crashes (which can happen very often&hellip;), making sure your webhook will always be up and listening for incoming requests.</p>

<p>What I do in my projects is the following:</p>

<p>Install localtunnel in the project and save to dev-dependencies</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span> <span class="nx">localtunnel</span>
</code></pre></div>

<p>Then in my <code>package.json</code>, add something like this in my &lsquo;scripts&rsquo;:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="s2">&quot;scripts&quot;</span><span class="err">:</span> <span class="p">{</span>
  <span class="err">.</span>
  <span class="err">.</span>
  <span class="nt">&quot;tunnel&quot;</span><span class="p">:</span> <span class="s2">&quot;( while true; do lt -p 3000 -s botmastersubdomain; done; )&quot;</span><span class="p">,</span>
  <span class="err">.</span>
  <span class="err">.</span>
<span class="p">}</span><span class="err">,</span>
</code></pre></div>

<p>I can then simply run the runnel as follows (most likely in another console tab):</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>npm run tunnel
</code></pre></div>
</div>
    </div>
  </main>
  <script>
    function showNavMenu() {
      var sidebar = document.getElementById('sidebar')

      if (sidebar.className.indexOf('dn') !== -1) {
        sidebar.className = 'fl w-100 w-20-l pr2-l di-l'
      } else {
        sidebar.className = 'fl w-100 w-20-l pr2-l di-l dn'
      }
    }
  </script>
</body>

</html>

